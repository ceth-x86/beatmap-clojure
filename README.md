# beatmap

A Clojure application for interacting with Apple Music API, managing tokens securely, and exporting user albums to CSV format.

## Features

- **Apple Music Integration**: Fetch user albums from Apple Music library
- **Secure Token Management**: Layered configuration with environment variables
- **CSV Export**: Export albums with artist, year, and album name to CSV
- **Case-Insensitive Sorting**: Albums are sorted by artist, year, and album name, all case-insensitive
- **Progress Tracking**: Real-time progress display during album fetching
- **Modular Architecture**: Clean separation of concerns with dedicated modules

## Project Structure

```
src/beatmap/
â”œâ”€â”€ beatmap.clj      # Main application entry point
â”œâ”€â”€ apple_music.clj  # Apple Music API integration
â”œâ”€â”€ csv_export.clj   # CSV export functionality
â”œâ”€â”€ config.clj       # Configuration management
â”œâ”€â”€ tokens.clj       # Token validation and management
â”œâ”€â”€ entities.clj     # Domain entities and sorting logic
â””â”€â”€ operations.clj   # High-level album processing operations
```

## Installation

Download from https://github.com/beatmap/beatmap

## Usage

### Quick Start

1. **Setup configuration:**
   ```bash
   make setup-config
   ```

2. **Run the application:**
   ```bash
   make run
   ```

The application will:
- Validate your Apple Music tokens
- Fetch all albums from your library (with pagination)
- Save them to `resources/catalog/albums.csv` with columns: Artist, Year, Album (sorted case-insensitively)
- Display sample albums in the console

### Configuration

For detailed configuration instructions, see [Configuration Guide](doc/configuration.md).

**Quick setup:**
- Copy `config/local.edn.example` to `config/local.edn`
- Edit `config/local.edn` with your actual tokens and secrets
- Optionally create `.env` file from `env.example` for environment variables

### Tokens

The application uses three tokens:
- `developer-token` - Developer authentication token
- `user-token` - User authentication token
- `openai-api-key` - OpenAI API key

For detailed token usage, see [Tokens Usage Guide](doc/tokens-usage.md).

### Available Commands

Run the application:
```bash
make run
# or
clojure -X:run-x
```

Setup configuration:
```bash
make setup-config
```

Run tests:
```bash
clojure -T:build test
```

Build uberjar:
```bash
clojure -T:build ci
java -jar target/beatmap-0.1.0-SNAPSHOT.jar
```

## Examples

### Sample Output

When you run the application, you'll see output like:

```
Hello, Clojure!
Running beatmap application
âœ… All tokens are configured
ðŸŽµ Starting Apple Music integration...
ðŸŽµ Fetching first 100 albums for main application...
ðŸ“„ Fetching page 1 (offset: 0)...
âœ… Page 1 loaded: 25 albums
ðŸ“Š Total albums so far: 25
...
ðŸ’¾ Saving 100 albums to CSV file...
âœ… Written 100 albums to resources/catalog/albums.csv
âœ… Successfully saved albums to: resources/catalog/albums.csv
ðŸ“Š Sample of your albums:
   1. IDLES (2019) - A Beautiful Thing: IDLES Live at Le Bataclan
   2. Depeche Mode (1982) - A Broken Frame (Deluxe)
   3. Biffy Clyro (2020) - A Celebration of Endings
```

### CSV Output Format

The generated `resources/catalog/albums.csv` file contains:
- **Artist**: Artist name
- **Year**: Release year (or "Unknown" if not available)
- **Album**: Album name

### API Usage Note

When calling functions like `get-user-albums`, use keyword arguments and numbers (e.g., `:limit 5`, `:offset 20`), not string keys or values.

## License

Copyright Â© 2025 Ceth

_EPLv1.0 is just the default for projects generated by `clj-new`: you are not_
_required to open source this project, nor are you required to use EPLv1.0!_
_Feel free to remove or change the `LICENSE` file and remove or update this_
_section of the `README.md` file!_

Distributed under the Eclipse Public License version 1.0.
